---
title: "Air Pollution"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---
*Dashboard developed by Kiran using the Plotly R package, data from EPA*

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(rnoaa)
library(ggplot2)
library(plotly)
library(flexdashboard)

```

```{r, include=FALSE}

ma_pm2_5 = read_csv("./data/ma_pm2_5.csv") %>% 
  janitor::clean_names() %>% 
  drop_na(local_site_name) %>% 
  mutate(date = as.Date(date, format = "%m/%d/%Y"),
         local_site_name = tolower(local_site_name)) %>% 
    rename(pm_2_5_ugm3_daily = daily_mean_pm2_5_concentration,
           latitude = site_latitude,
           longitude = site_longitude) 

ma_pm2_5_summary = ma_pm2_5 %>% 
    filter(date >= "2023-07-01" & date <= "2023-08-31") %>% 
      group_by(site_id, local_site_name, latitude, longitude) %>% 
      summarize(avg_pm2_5 = mean(pm_2_5_ugm3_daily))
  

```

```{r, include=FALSE}
# Create text label
ma_pm2_5_summary <- ma_pm2_5_summary %>%
  mutate(text_label = str_c(
    "PM2.5 Average = ", round(avg_pm2_5, 2), " µg/m³", "\nSite: ", local_site_name))

# Plotly plot
air_plot <- 
  plot_ly(
  data = ma_pm2_5_summary,
  x = ~latitude, y = ~longitude,
  type = "scatter", mode = "markers",
  color = ~avg_pm2_5,
  colors = "viridis",
  text = ~text_label,
  alpha = 1.0,
  marker = list(
    size = ~avg_pm2_5*4,  
    opacity = 0.5  
  )) %>%
layout(
  title = "Average PM2.5 (µg/m³) across Sites in MA in July-Aug 2023")
```



```{r, include=FALSE}
air_boxplot <- ma_pm2_5 %>%
  plot_ly(
    y = ~pm_2_5_ugm3_daily,
    color = ~local_site_name,
    type = "box",
    colors = "viridis"
  ) %>%
  layout(
    title = "Average PM2.5 (µg/m³) across Sites in MA in July-Aug 2023")

```

Column {data-width=650}
-----------------------------------------------------------------------

```{r, warning=FALSE}

air_plot

```

Column {data-width=650}
-----------------------------------------------------------------------

```{r, warning=FALSE}

air_boxplot

```

