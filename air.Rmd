---
title: "PM2.5"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: spacelab
---
*Dashboard developed by Kiran using the Plotly R package, data from NOAA*

```{r setup, include=FALSE}
library(tidyverse)
library(dplyr)
library(rnoaa)
library(ggplot2)
library(plotly)
library(flexdashboard)

```

```{r, include=FALSE}

ma_pm2_5 = read_csv("./data/ma_pm2_5.csv") %>% 
  janitor::clean_names() %>% 
  drop_na(local_site_name) %>% 
  mutate(date = as.Date(date, format = "%m/%d/%Y"),
         local_site_name = tolower(local_site_name)) %>% 
    rename(pm_2_5_ugm3_daily = daily_mean_pm2_5_concentration,
           latitude = site_latitude,
           longitude = site_longitude) %>% 
      filter(date >= "2023-07-01" & date <= "2023-08-31") 


ma_pm2_5_summary = ma_pm2_5 %>% 
    filter(date >= "2023-07-01" & date <= "2023-08-31") %>% 
      group_by(site_id, local_site_name, latitude, longitude) %>% 
      summarize(avg_pm2_5 = mean(pm_2_5_ugm3_daily))

# Create text label
ma_pm2_5_summary <- ma_pm2_5_summary %>%
  mutate(text_label = str_c(
    "PM2.5 Average = ", round(avg_pm2_5, 2), " µg/m³", "\nSite: ", local_site_name))

# Plotly plot

air_plot <- plot_ly(
  data = ma_pm2_5_summary,
  x = ~latitude, y = ~longitude,
  type = "scatter", mode = "markers",
  color = ~avg_pm2_5,
  colors = "viridis",
  text = ~text_label,
  alpha = 1.0,
  marker = list(
    size = ~avg_pm2_5 * 4,  
    opacity = 0.5  
  )
) %>%
  layout(
    xaxis = list(title = "Latitude"),
    yaxis = list(title = "Longitude"),
    coloraxis = list(colorbar = list(title = "Avg PM2.5")),
    title = "Air Quality in MA by Latitude and Longitude"
  )


  

```

```{r}

air_plot

```

